---
import Layout from '../../layouts/Layout.astro';
import HotelLocationPage from '../../components/pages/HotelLocationPage.astro';
import hotelData from '../../../data/brisbaneHotels.json';
import locationData from '../../../data/locations.json';
import type { Location } from '../../types/types.d';
import { generateHotelLocationMetadata } from '../../utils/metadata';

// Get the slug from the URL
const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect('/404');
}

// Find the location data from the locations.json file using the SEO-friendly slug
const locationInfo = locationData.locations.find(loc => loc.slug === slug);

if (!locationInfo) {
  return Astro.redirect('/404');
}

// Find the corresponding hotel data from the brisbaneHotels.json file
// We use the locationInfo.id to match with hotelLocationData.id
const hotelLocationData = hotelData.locations.find(loc => loc.id === locationInfo.id);

// If hotel data not found, redirect to 404
if (!hotelLocationData) {
  return Astro.redirect('/404');
}

// Create a complete Location object that matches the type
const location: Location = {
  id: locationInfo.id,
  name: locationInfo.name,
  slug: locationInfo.slug,
  heroImage: locationInfo.heroImage || "",
  description: locationInfo.description,
  tips: locationInfo.tips,
  categories: hotelLocationData.categories
};

// Get metadata from the utility function
const { title, description, keywords } = generateHotelLocationMetadata(location);
---

<Layout title={title} description={description} keywords={keywords}>
  <main>
    <HotelLocationPage location={location} />
  </main>
</Layout> 